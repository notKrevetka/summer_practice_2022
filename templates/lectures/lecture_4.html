{% extends 'lecture_base.html' %}


{% block head %}
<title>>IPython Magic Commands</title>
{% endblock %}


{% block body %}


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
        <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
        </div>
        <div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt
                jp-InputArea-prompt">
            </div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown
                jp-MarkdownOutput " data-mime-type="text/markdown">
                <h1 id="IPython-Magic-Commands">IPython Magic Commands<a
                        class="anchor-link" href="#IPython-Magic-Commands">&#182;</a></h1>
            </div>
        </div>
    </div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
        <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
        </div>
        <div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt
                jp-InputArea-prompt">
            </div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown
                jp-MarkdownOutput " data-mime-type="text/markdown">
                <p>The previous two sections showed how IPython lets you use and
                    explore Python efficiently and interactively.
                    Here we'll begin discussing some of the enhancements that
                    IPython adds on top of the normal Python syntax.
                    These are known in IPython as <em>magic commands</em>, and
                    are prefixed by the <code>%</code> character.
                    These magic commands are designed to succinctly solve
                    various common problems in standard data analysis.
                    Magic commands come in two flavors: <em>line magics</em>,
                    which are denoted by a single <code>%</code> prefix and
                    operate on a single line of input, and <em>cell magics</em>,
                    which are denoted by a double <code>%%</code> prefix and
                    operate on multiple lines of input.
                    We'll demonstrate and discuss a few brief examples here, and
                    come back to more focused discussion of several useful magic
                    commands later in the chapter.</p>

            </div>
        </div>
    </div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
        <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
        </div>
        <div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt
                jp-InputArea-prompt">
            </div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown
                jp-MarkdownOutput " data-mime-type="text/markdown">
                <h2 id="Pasting-Code-Blocks:-%25paste-and-%25cpaste">Pasting
                    Code Blocks: <code>%paste</code> and <code>%cpaste</code><a
                        class="anchor-link"
                        href="#Pasting-Code-Blocks:-%25paste-and-%25cpaste">&#182;</a></h2><p>When
                    working in the IPython interpreter, one common gotcha is
                    that pasting multi-line code blocks can lead to unexpected
                    errors, especially when indentation and interpreter markers
                    are involved.
                    A common case is that you find some example code on a
                    website and want to paste it into your interpreter.
                    Consider the following simple function:</p>
                <div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">donothing</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">x</span>
</pre></div>
                <p>The code is formatted as it would appear in the Python
                    interpreter, and if you copy and paste this directly into
                    IPython you get an error:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">donothing</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="o">...</span>     <span class="k">return</span> <span class="n">x</span>
   <span class="o">...</span><span class="p">:</span>     
  <span class="n">File</span> <span class="s2">&quot;&lt;ipython-input-20-5a66c8964687&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span>
    <span class="o">...</span>     <span class="k">return</span> <span class="n">x</span>
                 <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</pre></div>
                <p>In the direct paste, the interpreter is confused by the
                    additional prompt characters.
                    But never fear–IPython's <code>%paste</code> magic function
                    is designed to handle this exact type of multi-line,
                    marked-up input:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">%</span><span class="k">paste</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">donothing</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">x</span>

<span class="c1">## -- End pasted text --</span>
</pre></div>
                <p>The <code>%paste</code> command both enters and executes the
                    code, so now the function is ready to be used:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">donothing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">10</span>
</pre></div>
                <p>A command with a similar intent is <code>%cpaste</code>,
                    which opens up an interactive multiline prompt in which you
                    can paste one or more chunks of code to be executed in a
                    batch:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="o">%</span><span class="k">cpaste</span>
<span class="n">Pasting</span> <span class="n">code</span><span class="p">;</span> <span class="n">enter</span> <span class="s1">&#39;--&#39;</span> <span class="n">alone</span> <span class="n">on</span> <span class="n">the</span> <span class="n">line</span> <span class="n">to</span> <span class="n">stop</span> <span class="ow">or</span> <span class="n">use</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">D</span><span class="o">.</span>
<span class="p">:</span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">donothing</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="p">:</span><span class="o">...</span>     <span class="k">return</span> <span class="n">x</span>
<span class="p">:</span><span class="o">--</span>
</pre></div>
                <p>These magic commands, like others we'll see, make available
                    functionality that would be difficult or impossible in a
                    standard Python interpreter.</p>

            </div>
        </div>
    </div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
        <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
        </div>
        <div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt
                jp-InputArea-prompt">
            </div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown
                jp-MarkdownOutput " data-mime-type="text/markdown">
                <h2 id="Running-External-Code:-%25run">Running External Code:
                    <code>%run</code><a class="anchor-link"
                        href="#Running-External-Code:-%25run">&#182;</a></h2><p>As
                    you begin developing more extensive code, you will likely
                    find yourself working in both IPython for interactive
                    exploration, as well as a text editor to store code that you
                    want to reuse.
                    Rather than running this code in a new window, it can be
                    convenient to run it within your IPython session.
                    This can be done with the <code>%run</code> magic.</p>
                <p>For example, imagine you've created a <code>myscript.py</code>
                    file with the following contents:</p>
                <div class="highlight"><pre><span></span><span class="c1">#-------------------------------------</span>
<span class="c1"># file: myscript.py</span>

<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;square a number&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="s2">&quot;squared is&quot;</span><span class="p">,</span> <span class="n">square</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
</pre></div>
                <p>You can execute this from your IPython session as follows:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="o">%</span><span class="k">run</span> myscript.py
<span class="mi">1</span> <span class="n">squared</span> <span class="ow">is</span> <span class="mi">1</span>
<span class="mi">2</span> <span class="n">squared</span> <span class="ow">is</span> <span class="mi">4</span>
<span class="mi">3</span> <span class="n">squared</span> <span class="ow">is</span> <span class="mi">9</span>
</pre></div>
                <p>Note also that after you've run this script, any functions
                    defined within it are available for use in your IPython
                    session:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">square</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">25</span>
</pre></div>
                <p>There are several options to fine-tune how your code is run;
                    you can see the documentation in the normal way, by typing
                    <strong><code>%run?</code></strong> in the IPython
                    interpreter.</p>

            </div>
        </div>
    </div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
        <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
        </div>
        <div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt
                jp-InputArea-prompt">
            </div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown
                jp-MarkdownOutput " data-mime-type="text/markdown">
                <h2 id="Timing-Code-Execution:-%25timeit">Timing Code Execution:
                    <code>%timeit</code><a class="anchor-link"
                        href="#Timing-Code-Execution:-%25timeit">&#182;</a></h2><p>Another
                    example of a useful magic function is <code>%timeit</code>,
                    which will automatically determine the execution time of the
                    single-line Python statement that follows it.
                    For example, we may want to check the performance of a list
                    comprehension:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="o">%</span><span class="k">timeit</span> L = [n ** 2 for n in range(1000)]
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">325</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
                <p>The benefit of <code>%timeit</code> is that for short
                    commands it will automatically perform multiple runs in
                    order to attain more robust results.
                    For multi line statements, adding a second <code>%</code>
                    sign will turn this into a cell magic that can handle
                    multiple lines of input.
                    For example, here's the equivalent construction with a
                    <code>for</code>-loop:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="o">%%time</span>it
   <span class="o">...</span><span class="p">:</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> 
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">373</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
                <p>We can immediately see that list comprehensions are about 10%
                    faster than the equivalent <code>for</code>-loop
                    construction in this case.
                    We'll explore <code>%timeit</code> and other approaches to
                    timing and profiling code in <a
                        href="01.07-Timing-and-Profiling.ipynb">Profiling and
                        Timing Code</a>.</p>

            </div>
        </div>
    </div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
    <div class="jp-Cell-inputWrapper">
        <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
        </div>
        <div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt
                jp-InputArea-prompt">
            </div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown
                jp-MarkdownOutput " data-mime-type="text/markdown">
                <h2 id="Help-on-Magic-Functions:-?,-%25magic,-and-%25lsmagic">Help
                    on Magic Functions: <code>?</code>, <code>%magic</code>, and
                    <code>%lsmagic</code><a class="anchor-link"
                        href="#Help-on-Magic-Functions:-?,-%25magic,-and-%25lsmagic">&#182;</a></h2><p>Like
                    normal Python functions, IPython magic functions have
                    docstrings, and this useful
                    documentation can be accessed in the standard manner.
                    So, for example, to read the documentation of the <code>%timeit</code>
                    magic simply type this:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> %timeit<span class="o">?</span>
</pre></div>
                <p>Documentation for other functions can be accessed similarly.
                    To access a general description of available magic
                    functions, including some examples, you can type this:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="o">%</span><span class="k">magic</span>
</pre></div>
                <p>For a quick and simple list of all available magic functions,
                    type this:</p>
                <div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="o">%</span><span class="k">lsmagic</span>
</pre></div>
                <p>Finally, I'll mention that it is quite straightforward to
                    define your own magic functions if you wish.
                    We won't discuss it here, but if you are interested, see the
                    references listed in <a
                        href="01.08-More-IPython-Resources.ipynb">More IPython
                        Resources</a>.</p>

                {% endblock %}